<div class="min-h-screen bg-gray-100 p-6">
  <div class="bg-white p-6 rounded-xl shadow-lg max-w-5xl mx-auto">
    <h2 class="text-2xl font-bold text-blue-900 mb-4 text-center">Ventas</h2>

    <table class="min-w-full bg-white border border-gray-200 rounded-md">
      <thead class="bg-gray-200 text-gray-700">
        <tr>
          <th class="py-2 px-4 text-left">Fecha</th>
          <th class="py-2 px-4 text-left">Cliente</th>
          <th class="py-2 px-4 text-left">Total</th>
          <th class="py-2 px-4 text-left">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let venta of ventas">
          <tr class="border-t">
            <td class="py-2 px-4">{{ venta.fecha }}</td>
            <td class="py-2 px-4">{{ venta.nombre_cliente }}</td>
            <td class="py-2 px-4">$ {{ venta.total | number: '1.2-2' }}</td>
            <td class="py-2 px-4">
              <div class="flex flex-col sm:flex-row gap-2">
              <button
              class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-1 rounded-md w-full sm:w-auto"
              (click)="abrirModalDetalle(venta.id_venta)"
              >
              Agregar Detalle
              </button>
              <button
              class="bg-red-600 hover:bg-red-500 text-white px-4 py-1 rounded-md w-full sm:w-auto"
              (click)="confirmarEliminacionVenta(venta.id_venta)"
              >
               Eliminar
              </button>
              </div>
            </td>
        
          </tr>



          <tr *ngIf="ventaSeleccionada === venta.id_venta && detallesVenta.length">
  <td colspan="4">
    <table class="w-full mt-4 text-sm border">
      <thead class="bg-gray-200">
        <tr>
          <th>Artículo</th>
          <th>Cantidad</th>
          <th>Precio Unitario</th>
          <th>Subtotal</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let d of detallesVenta">
          <td>{{ d.nombre_articulo }}</td>
          <td>
            <input *ngIf="modoEdicion[d.id_detalle]" [(ngModel)]="d.cantidad" type="number"  min="1" required class="border px-1 w-16" />
            <span *ngIf="!modoEdicion[d.id_detalle]">{{ d.cantidad }}</span>
          </td>
          <td>
            <input *ngIf="modoEdicion[d.id_detalle]" [(ngModel)]="d.precio_u" type="number"  min="0.01" step="0.1" required class="border px-1 w-20" />
            <span *ngIf="!modoEdicion[d.id_detalle]">{{ d.precio_u | number:'1.2-2' }}</span>
          </td>
          <td>{{ d.subtotal | number:'1.2-2' }}</td>
          <td>
            <button *ngIf="!modoEdicion[d.id_detalle]" (click)="activarEdicion(d.id_detalle)" class="text-blue-600">Editar</button>
            <button *ngIf="modoEdicion[d.id_detalle]" (click)="guardarEdicion(d)" class="text-green-600">Guardar</button>
            <button (click)="eliminarDetalle(d.id_detalle)" class="text-red-600 ml-2">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </td>
</tr>
   


          <tr *ngIf="ventaSeleccionada === venta.id_venta" class="bg-gray-50">
            <td colspan="4" class="py-4 px-4">
              <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <select [(ngModel)]="detalle.id_articulo" (change)="onArticuloChange()" 
                 #articulo="ngModel"
                 name="articulo"
                  class="border border-gray-300 rounded-md px-3 py-2 w-full">
                  <option [ngValue]="null">-- Artículo --</option>
                  <option *ngFor="let articulo of articulos" [ngValue]="articulo.id_articulo">
                    {{ articulo.nombre }}
                  </option>
                </select>
                <div *ngIf="articulo.invalid && articulo.touched" class="text-red-600 text-xs">
                  Debes seleccionar un articulo.
                </div>


                <input type="number" [(ngModel)]="detalle.cantidad" min="1" placeholder="Cantidad" #cantidad="ngModel" name="cantidad"
                  class="border border-gray-300 rounded-md px-3 py-2 w-full" />
                <div *ngIf="cantidad.invalid && cantidad.touched" class="text-red-600 text-xs">
                  La cantidad debe ser un número valido mayor a 0.</div>

                <button
                  (click)="agregarDetalle()"
                  class="bg-green-700 hover:bg-green-600 text-white px-4 py-2 rounded-md w-full">
                  Guardar Detalle
                </button>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>

    <div class="mt-6 text-right">
      <button
        class="bg-green-600 hover:bg-green-500 text-white font-medium px-6 py-2 rounded-md"
        (click)="mostrarFormulario = !mostrarFormulario"
      >
        Nueva Venta
      </button>
    </div>

    <div *ngIf="mostrarFormulario" class="mt-4 bg-gray-50 p-4 rounded-md shadow-inner">
      <label for="cliente" class="block font-medium text-gray-700 mb-2">Cliente:</label>
      <select
        id="cliente"
        [(ngModel)]="id_clienteSeleccionado"
        name="cliente"
        class="w-full border border-gray-300 rounded-md px-4 py-2 mb-4"
      >
        <option [ngValue]="null">-- Selecciona cliente --</option>
        <option *ngFor="let cliente of clientes" [ngValue]="cliente.id_cliente">
          {{ cliente.nombre }}
        </option>
      </select>

      <button
        class="bg-gray-900 hover:bg-gray-800 text-white px-5 py-2 rounded-md"
        (click)="crearVenta()"
      >
        Guardar Venta
      </button>
    </div>
  </div>
</div>

<div *ngIf="ventaAEliminar !== null" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-white p-6 rounded-xl shadow-md w-full max-w-md text-center">
    <p class="text-lg font-semibold mb-4">¿Estas seguro que deseas eliminar esta venta?</p>
    <div class="flex justify-center gap-4">
      <button (click)="eliminarVentaConfirmada()" class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 rounded">Sí, eliminar</button>
      <button (click)="cancelarEliminacionVenta()" class="bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded">Cancelar</button>
    </div>
  </div>
</div>

